<section class="chat">
    <h1><%= title %></h1>
    <div class="prev-messages">
        <% for (let message of messages) { %>
            <div class="prev-message <%= (message.user === user?.email) ? "user-message" : "other-message" %>">
                <div class="message-header">
                    <p class="prev-message-user">
                        <%= user 
                            ? message.user 
                            : message.user.replace(/^[^@]+(?=@)/, m =>
                                m.split("").map((ch, i, arr) => {
                                if (
                                    ch === "." ||
                                    i === 0 ||
                                    arr[i - 1] === "."
                                ) return ch;
                                return "*";
                                }).join("")
                            )
                        %>
                    </p>
                    <p class="prev-message-time"><%= (user) ? message.time : message.time.replace(/^(\S+\s\S+)/, match => "*".repeat(match.length)) %></p>
                </div>
                <div class="message-content">
                    <p><%= message.text %></p>
                </div>
            </div>
        <% } %>
    </div>
    <form method="post" action="/chat" class="add-message">
        <input aria-label="message" placeholder="Message..." type="text" name="message" id="message">
        <button type="submit" onclick=onButtonClick>></button>
    </form>
    <script>
        const container = document.querySelector(".prev-messages");
        container.scrollTop = container.scrollHeight;

        function onButtonClick() {
            container.scrollTop = container.scrollHeight;
        }
    </script>
</section>